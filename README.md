# iWebShelter

一个基于浏览器的局域网文件交换平台，实现Windows、Mac、Linux、iOS、Android、鸿蒙等多种终端之间的无缝文件共享与实时消息传递。

## 项目简介

iWebShelter 解决了局域网内不同设备之间文件传输的痛点，无需安装客户端软件，只需通过浏览器即可实现跨平台文件共享。无论是办公室内的文件交换，还是家庭网络中的资源共享，特别是电脑与移动终端间的文件共享都能轻松完成，再也不用通过微信、QQ等即时通讯软件传输文件。

<img width="1063" height="718" alt="image" src="https://github.com/user-attachments/assets/53b680f5-89fc-486c-bbf4-e55ecb98ead2" />


### 核心价值
- **跨平台兼容**：基于标准Web技术，支持所有主流操作系统和设备
- **无需客户端**：纯浏览器访问，零安装负担
- **局域网高效**：本地网络传输，速度快，不受外网带宽限制
- **安全可控**：完全本地运行，数据不经过第三方服务器
- **实时通信**：支持文本消息和文件传输的实时通知

## 核心功能

### 基础功能
- **实时消息传递**：支持文本消息的实时发送和接收
- **文件上传**：支持单个文件的上传和管理
- **文件下载**：支持从历史记录中下载文件
- **历史记录**：查看房间内的所有历史消息和文件
- **记录删除**：支持删除不需要的历史记录

### 高级功能
- **文件夹上传**：支持整个文件夹的批量上传（自动压缩为ZIP）
- **多房间隔离**：基于6位数字房间号的安全隔离，不同场景使用不同房间
- **匿名房间**：特定房间支持匿名模式，保护用户隐私
- **特殊房间**：特定房间的记录不会被自动清理

## 使用场景

### 文件版本管理器
**问题**：需要跟踪文件的不同版本，避免版本混乱

**解决方案**：为每个项目创建专属房间，上传的文件按时间顺序显示在历史记录中

**使用方法**：
1. 创建项目专属房间（例如：项目A使用111111）
2. 每次修改文件后，上传新版本
3. 历史记录中会按时间顺序显示所有版本
4. 点击对应版本的文件卡片即可下载
**优势**：无需复杂的版本控制软件，直观查看版本历史

### 小工作室文件共享平台
**问题**：工作室成员之间需要频繁共享文件，传统方式效率低下

**解决方案**：创建工作室公共房间，成员通过浏览器即可共享文件

**使用方法**：
1. 创建工作室公共房间（例如：888888）
2. 成员输入房间号即可加入
3. 上传文件到房间，自动通知所有成员
4. 查看历史记录找到需要的文件
**优势**：无需配置网络共享，跨平台无缝兼容，实时通知机制

### 家庭成员资源共享
**问题**：家庭成员之间共享照片、视频等资源不便

**解决方案**：创建家庭专属房间，轻松共享家庭资源

**使用方法**：
1. 创建家庭房间（例如：666666）
2. 家庭成员输入房间号加入
3. 上传照片、视频等资源
4. 其他成员随时查看和下载
**优势**：老人小孩都能使用，无需安装复杂软件

### 内部公告栏
**问题**：需要在团队内部发布公告和通知

**解决方案**：创建公告专用房间，发布重要通知

**使用方法**：
1. 创建公告房间（例如：999999）
2. 管理员在房间内发布公告
3. 成员通过浏览器查看最新公告
4. 重要公告可使用特殊房间功能永久保存
**优势**：实时通知，历史可追溯，无需邮件轰炸

### 临时文件传输
**问题**：需要向同事快速传输大文件，邮件附件受限

**解决方案**：创建临时房间，快速完成文件传输

**使用方法**：
1. 创建临时房间（例如：123456）
2. 上传需要传输的文件
3. 告诉同事房间号
4. 同事进入房间下载文件
**优势**：不受文件大小限制，局域网传输速度快

## 独特优势

### 与传统方案对比
- **无需配置网络共享**：传统文件共享需要复杂的权限设置，iWebShelter只需输入房间号
- **无需安装客户端**：相比各种文件传输工具，iWebShelter零安装负担
- **跨平台无缝兼容**：解决了不同操作系统间的文件传输障碍
- **实时通知机制**：相比邮件或其他异步方式，提供实时的传输状态反馈
- **智能存储空间管理**：自动清理过期内容，保持系统整洁

### 技术优势
- **WebSocket实时通信**：使用WebSocket实现客户端与服务器的实时双向通信
- **响应式设计**：完美适配桌面和移动设备屏幕
- **文件类型图标**：支持多种文件类型的图标显示，直观识别文件类型
- **会话管理**：基于cookie的安全会话管理，支持会话超时检测
- **限流保护**：登录请求限流，防止暴力破解

## 技术栈

### 后端
- **Python 3.11+**：核心编程语言
- **FastAPI**：现代异步Web框架，提供高性能API
- **SQLAlchemy**：ORM数据库工具，操作SQLite数据库
- **SQLite**：轻量级嵌入式数据库，存储记录信息
- **WebSocket**：实时通信协议，实现双向实时通信
- **YAML**：配置文件格式

### 前端
- **HTML5/CSS3**：页面结构和样式
- **JavaScript**：客户端逻辑
- **Tailwind CSS**：实用优先的CSS框架
- **JSZip**：JavaScript压缩库，用于文件夹上传

### 依赖库
- `fastapi`：Web框架
- `uvicorn`：ASGI服务器
- `sqlalchemy`：ORM数据库工具
- `itsdangerous`：安全序列化库
- `ruamel.yaml`：YAML配置文件处理
- `python-multipart`：文件上传处理
- `websockets`：WebSocket支持

## 项目结构

```
iWebShelter/
├── app.py                 # 主应用入口
├── config.yaml            # 配置文件
├── database.db            # SQLite数据库文件
├── file_icons/            # 文件类型图标
├── logs/                  # 日志文件
├── uploads/               # 上传文件存储
│   ├── daily/             # 日常文件（按年/月/日组织）
│   └── persistent/        # 持久化文件
└── src/
    ├── api/
    │   ├── auth.py        # 认证相关API
    │   ├── records.py      # 记录管理API
    │   └── websocket.py    # WebSocket处理
    ├── models/
    │   └── db.py          # 数据库模型
    ├── static/
    │   └── icons/          # 静态资源图标
    ├── templates/
    │   ├── login.html      # 登录页面
    │   └── index.html      # 主页面
    └── utils/
        ├── helpers.py      # 辅助函数
        └── logger.py       # 日志工具
```

## 配置说明

### 核心配置项

**服务器配置**
- `port`：服务器运行端口
- `debug_mode`：调试模式开关
- `disable_record_deletion_rooms`：关闭历史记录手动删除功能的房间ID列表，为空表示所有房间都开启
- `history_retention_days`：历史记录保留天数
- `log_retention_days`：日志文件保留天数
- `login_rate_limit_min`：每分钟登录尝试次数限制
- `project_name`：项目名称，用于页面显示
- `anonymous_rooms`：匿名房间ID列表
- `safe_rooms`：安全房间ID列表
- `secret_key`：用于加密和签名的服务器密钥

**上传配置**
- `allowed_extensions`：允许上传的文件扩展名列表
- `max_file_size`：单个文件最大上传大小（MB）
- `static_path_prefix`：静态资源访问路径前缀
- `uploads_path`：上传文件存储目录
- `uploads_path_prefix`：上传文件访问路径前缀

### 配置示例

```yaml
# 服务器配置
server:
  port: 28099
  debug_mode: false
  disable_record_deletion_rooms: []
  history_retention_days: 90
  log_retention_days: 90
  login_rate_limit_min: 60
  project_name: "iWebShelter"
  anonymous_rooms:
    - 888888
  safe_rooms:
    - 000000
    - 123456
  secret_key: "your-secret-key"

# 上传配置
upload:
  allowed_extensions: []
  max_file_size: 1024
  static_path_prefix: static
  uploads_path: uploads
  uploads_path_prefix: uploads
```

## 快速开始

### 环境要求
- Python 3.11 或更高版本
- pip 包管理工具

### 安装依赖

```bash
# 安装项目依赖
pip install fastapi uvicorn sqlalchemy itsdangerous ruamel.yaml python-multipart websockets
```

### 启动服务器

```bash
# 启动服务器
python app.py

# 或者使用uvicorn直接运行
uvicorn app:app --host 0.0.0.0 --port 28099
```

服务器启动后，可通过以下地址访问：
- 本地访问：http://127.0.0.1:28099/login
- 网络访问：http://[服务器IP]:28099/login

## 使用指南

### 登录系统
1. 打开登录页面
2. 输入6位数字房间号（例如：123456）
3. 点击数字键盘或使用物理键盘输入
4. 输入完成后自动提交登录

### 发送消息
1. 登录成功后进入主页面
2. 在文本输入框中输入消息内容
3. 点击"发送"按钮或按Enter键发送

### 上传文件
1. 点击"📎文件上传"按钮
2. 在弹出的对话框中选择上传类型：
   - **文件**：选择单个或多个文件
   - **文件夹**：选择整个文件夹（会自动压缩为ZIP）
3. 选择文件或文件夹后自动开始上传
4. 上传完成后，文件会显示在历史记录中

### 下载文件
1. 在历史记录中找到要下载的文件
2. 点击文件卡片即可开始下载

### 删除记录
1. 在历史记录中找到要删除的记录
2. 点击记录右上角的删除按钮（×）
3. 确认删除操作

## API文档

### 认证API
- `POST /api/login`：登录接口，验证房间号并返回会话cookie

### 记录API
- `GET /api/records/{room_id}`：获取指定房间的历史记录
- `POST /api/send_text`：发送文本消息
- `POST /api/upload_file`：上传文件
- `DELETE /api/delete_record/{record_id}`：删除记录
- `GET /api/download/{record_id}`：下载文件
- `GET /api/config`：获取配置信息，包括文件大小限制

### WebSocket API
- `WS /ws/{room_id}`：WebSocket连接端点，用于实时通信

## 安全注意事项

1. **房间号保护**：请妥善保管房间号，避免泄露给无关人员
2. **文件安全**：上传的文件会存储在服务器上，请确保只上传安全的文件
3. **会话管理**：系统会自动清理过期会话，确保安全性
4. **匿名房间**：在匿名房间中，用户身份会被隐藏，增强隐私保护

## 部署建议

### 开发环境
- 直接运行 `python app.py` 启动开发服务器
- 可设置 `debug_mode: true` 启用调试模式

### 生产环境
- 设置 `debug_mode: false` 关闭调试模式
- 考虑使用进程管理器（如PM2）管理服务
- 配置适当的 `max_file_size` 限制，避免服务器空间被滥用
- 确保服务器有足够的存储空间用于文件上传

## 故障排除

### 常见问题

1. **无法登录**
   - 检查房间号格式是否正确（6位数字）
   - 检查网络连接是否正常
   - 检查服务器是否运行

2. **文件上传失败**
   - 检查文件大小是否超过限制
   - 检查文件类型是否被允许
   - 检查服务器存储空间是否充足

3. **消息发送失败**
   - 检查网络连接是否正常
   - 检查WebSocket连接是否正常
   - 检查会话是否过期

4. **记录不显示**
   - 检查房间号是否正确
   - 检查网络连接是否正常
   - 检查记录是否已被自动清理

### 日志查看

服务器日志存储在 `logs/` 目录中，可通过查看日志文件排查问题：

```bash
# 查看最新日志
cat logs/iwebshelter_$(date +%Y%m%d).log
```

## 维护与更新

### 定期维护
1. **检查存储空间**：定期检查上传文件目录的存储空间
2. **备份数据库**：定期备份 `database.db` 文件
3. **更新依赖**：定期更新项目依赖，确保安全性

### 版本更新
1. 拉取最新代码
2. 安装更新的依赖
3. 重启服务器

## 贡献

欢迎提交Issue和Pull Request，帮助改进iWebShelter项目。

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**注**：本项目仅供内部使用，请勿用于生产环境或公开部署，以免造成安全风险。
